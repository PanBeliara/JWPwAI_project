<html>
<head>
    <meta charset="utf-8">
    <title>Project</title>
    <script src="node_modules\animejs\lib\anime.min.js"></script>
    <style>
        .square
        {
            width: 0px;
            height: 0px;
        }
        .circle
        {
            border-radius: 50%;
        }
        .obstacle
        {
            background-color: black;
            position: absolute;
            left: 0px;
            top: 0px;
        }
        #mainActor
        {
            background-color: red;
            position: absolute;
            left: 0;
            top: 0;
        }
        #gameField
        {
            position: relative;
            border-style: solid;
            border-width: 10px;
            width: 700px;
            height: 500px;
        }
    </style>
</head>
<body>
    <input type="text" id="y" value="5">Wysokość planszy<br>
    <input type="text" id="x" value="7">Szerokość planszy<br>
    <button onclick="generate()">Generuj ponownie</button><br>
    <button onclick="mainActor.moveUp(map)">Up</button>
    <button onclick="mainActor.moveDown(map)">Down</button>
    <button onclick="mainActor.moveRight(map)">Right</button>
    <button onclick="mainActor.moveLeft(map)">Left</button>
    <div id="gameField">
        <div class="square circle" id="mainActor"></div>
    </div>
    



    <script>

        function addElement(parentId, elementTag, elementId, elementClass, html) 
        {
            var p = document.getElementById(parentId);
            var newElement = document.createElement(elementTag);
            newElement.setAttribute('id', elementId);
            newElement.setAttribute('class', elementClass);
            newElement.innerHTML = html;
            p.appendChild(newElement);
        }

        function removeElements(elementsClass)
        {
            var all = document.getElementsByClassName(elementsClass);
            while(all.length > 0) 
            {
                removeElement(all[0].id);
            }
        }
        function removeElement(elementId) 
        {
            var element = document.getElementById(elementId);
            element.parentNode.removeChild(element);
        }

        function findInMap(name)
        {
            for(var i=0; i<map.length; i++)
            {
                for(j=0; j<map[0].length; j++)
                {
                    if(map[i][j] == name)
                    {
                        var position = [i, j];
                        return position;
                    }
                }
            }
        }

        var cellSize = 50;

        

        var map = [
            ['b', 'b', 'b', 'b', 'b', 'b', 'b'],
            ['b', 'b', 'b', 'b', 'b', 'b', 'b'],
            ['b', 'b', 'b', 'b', 'b', 'b', 'b'],
            ['b', 'b', 'b', 'b', 'b', 'b', 'b'],
            ['b', 'b', 'b', 'b', 'b', 'b', 'b'],
        ];

        class ControllableElement
        {
            id;
            color;
            y;
            x;

            constructor(id, color)
            {
                this.id = id;
                this.color = color;

                document.getElementById(id).style.backgroundColor = this.color;
            }

            setPosition(x, y)
            {
                this.x = x;
                this.y = y;
            }

            positionElement()
            {
                document.getElementById(this.id).style.transform = "none";

                document.getElementById(this.id).style.left = cellSize*this.x;
                document.getElementById(this.id).style.top = cellSize*this.y;
            }

            moveDown(map)
            {
                if(this.y + 1 < map.length)
                {
                    if(map[this.y + 1][this.x] != 'O')
                    {
                        this.y++;
                        anime({
                            targets: '#'+this.id,
                            translateY: (cellSize*this.y - parseInt(document.getElementById(this.id).style.top)),
                            duration: 800
                        });
                        document.getElementById(this.id).innerHTML = this.x+" "+this.y;
                    }
                }
            }
            moveUp(map)
            {
                if(this.y > 0)
                {
                    if(map[this.y - 1][this.x] != 'O')
                    {
                        this.y--;
                        anime({
                            targets: '#'+this.id,
                            translateY: (cellSize*this.y - parseInt(document.getElementById(this.id).style.top)),
                            duration: 800
                        });
                        document.getElementById(this.id).innerHTML = this.x+" "+this.y;
                    }
                }
            }
            moveRight(map)
            {
                if(this.x + 1 < map[0].length)
                {
                    if(map[this.y][this.x + 1] != 'O')
                    {
                        this.x++;
                        anime({
                            targets: '#'+this.id,
                            translateX: (cellSize*this.x - parseInt(document.getElementById(this.id).style.left)),
                            duration: 800
                        });
                        document.getElementById(this.id).innerHTML = this.x+" "+this.y;
                    }
                }
            }
            moveLeft(map)
            {
                if(this.x > 0)
                {
                    if(map[this.y][this.x - 1] != 'O')
                    {
                        this.x--;
                        anime({
                            targets: '#'+this.id,
                            translateX: (cellSize*this.x - parseInt(document.getElementById(this.id).style.left)),
                            duration: 800
                        });
                        document.getElementById(this.id).innerHTML = this.x+" "+this.y;
                    }
                }
            }
        }

        var mainActor = new ControllableElement("mainActor", "yellow");

        function generate()
        {
            removeElements("obstacle");

            if(!isNaN(document.getElementById("y").value) && !isNaN(document.getElementById("x").value))
            {
                var x = parseInt(document.getElementById("x").value);
                var y = parseInt(document.getElementById("y").value);

                if(x < 3 || x > 30)
                    x = 3;
                if(y < 3 || y > 30)
                    y = 3;

                map = new Array(y);

                for(var i=0; i < y; i++)
                {
                    map[i] = new Array(x);
                    for(var j=0; j < x; j++)
                        map[i][j] = 'b';
                }
                
                document.getElementById("gameField").style.width = x*cellSize;
                document.getElementById("gameField").style.height = y*cellSize;

                setMainActorPosition();
                createObstacles(4);

                var mapa="";
                for(var i=0; i<map.length; i++)
                {
                    for(var j=0; j<map[0].length; j++)
                        mapa += map[i][j]+" ";
                    mapa += "\n";
                }
                
                var all = document.getElementsByClassName('square');
                for (var i = 0; i < all.length; i++) 
                {
                    all[i].style.width = cellSize;
                    all[i].style.height = cellSize;
                }
            }
        }
        
        function setMainActorPosition() //test
        {
            do
            {
                var x = Math.floor(Math.random()*map[0].length);
                var y = Math.floor(Math.random()*map.length);
            } while(map[y][x] != 'b');
            map[y][x] = 'MC';
            mainActor.setPosition(x, y);
            mainActor.positionElement();
            document.getElementById(mainActor.id).innerHTML = mainActor.x+" "+mainActor.y;
        }
        function createObstacles(amount = 5)
        {
            for(var i=0; i<amount; i++)
            {
                do
                {
                    var x = Math.floor(Math.random()*map[0].length);
                    var y = Math.floor(Math.random()*map.length);
                } while(map[y][x] != 'b');
                map[y][x] = 'O';
                addElement("gameField", "div" ,"obstacle"+(i+1), "square obstacle", "");
                document.getElementById("obstacle"+(i+1)).style.left = x*cellSize;
                document.getElementById("obstacle"+(i+1)).style.top = y*cellSize;
            }
        }

        generate();
    </script>
</body>
</html>